<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <title>D3 Test</title>
    <script type="text/javascript" src="d3/d3.js"></script>

    <style>
        .container {
            position: relative;
            height: 100%;
            width: 100%;
            margin: 0 auto;
        }

        .key {
            position: absolute;
            top: 0;
            left: 0;
        }

        .chart {
            position: absolute;
            top: 30px;
            left: 150px;
        }



        .chart text {
            font: 10px sans-serif;
        }

        .chart .title {
            font: 15px sans-serif;
        }

        .chart circle {
            cursor: pointer;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
    </style>


</head>


<body>

<h1>POKEMON</h1>

<div class="container">
    <div class="key">
        <p>Circle size = BMI (Body Mass Index: weight(kg) / height)</p>
        <br/>
        <ul>
            <li style="margin: 6px">grass: <span style="background: #008A2E; padding: 2px; margin: 4px;">&nbsp;</span>#008A2E
            </li>
            <li style="margin: 6px">fire: <span style="background: #FF0000; padding: 2px; margin: 4px;">&nbsp;</span>#FF0000
            </li>
            <li style="margin: 6px">water: <span style="background: #0000FF; padding: 2px; margin: 4px;">&nbsp;</span>#0000FF
            </li>
            <li style="margin: 6px">bug: <span style="background: #66FF33; padding: 2px; margin: 4px;">&nbsp;</span>#66FF33
            </li>
            <li style="margin: 6px">flying: <span style="background: #FFFF99; padding: 2px; margin: 4px;">&nbsp;</span>#FFFF99
            </li>
            <li style="margin: 6px">normal: <span style="background: #999999; padding: 2px; margin: 4px;">&nbsp;</span>#999999
            </li>
            <li style="margin: 6px">poison: <span style="background: #6600CC; padding: 2px; margin: 4px;">&nbsp;</span>#6600CC
            </li>
            <li style="margin: 6px">electric: <span style="background:#FFFF00; padding: 2px; margin: 4px;">&nbsp;</span>#FFFF00
            </li>
            <li style="margin: 6px">ground: <span style="background: #C6A971; padding: 2px; margin: 4px;">&nbsp;</span>#C6A971
            </li>
            <li style="margin: 6px">fairy: <span style="background: #FFCCFF; padding: 2px; margin: 4px;">&nbsp;</span>#FFCCFF
            </li>
            <li style="margin: 6px">fighting: <span
                    style="background: #CC3300; padding: 2px; margin: 4px;">&nbsp;</span>#CC3300
            </li>
            <li style="margin: 6px">psychic: <span style="background: #6600FF; padding: 2px; margin: 4px;">&nbsp;</span>#6600FF
            </li>
            <li style="margin: 6px">rock: <span style="background: #663300; padding: 2px; margin: 4px;">&nbsp;</span>#663300
            </li>
            <li style="margin: 6px">ghost: <span style="background: #8A4ACC; padding: 2px; margin: 4px;">&nbsp;</span>#8A4ACC
            </li>
            <li style="margin: 6px">dragon: <span style="background: #FF3399; padding: 2px; margin: 4px;">&nbsp;</span>#FF3399
            </li>
        </ul>
    </div>
    <div class="chart"></div>

</div>
<script type="text/javascript"> //src = d3/d3.js?

d3.csv("Pokemon.csv", function (err, data) {
    var pokemon = [],
            height = 500,
            width = 800,
            margin = 40,
            labelX = 'Pokemon ID',
            labelY = 'Base Experience';
    var svg = d3.select('.chart')
            .append('svg')
            .attr('class', 'chart')
            .attr("width", width + margin + margin)
            .attr("height", height + margin + margin)
            .append("g")
            .attr("transform", "translate(" + margin + "," + margin + ")");

    var colorMap = {
        grass: "#008A2E",
        fire: "#FF0000",
        water: "#0000FF",
        bug: "#66FF33",
        flying: "#FFFF99",
        normal: "#999999",
        poison: "#6600CC",
        electric: "#FFFF00",
        ground: "#C6A971",
        fairy: "#FFCCFF",
        fighting: "#CC3300",
        psychic: "#6600FF",
        rock: "#663300",
        ghost: "#8A4ACC",
        dragon: "#FF3399"
    };

    function calcBMI(height, weight) {
        //assume weight in kg
        return (weight / (height * height));
    }

    function mapBMI() {
        if (pokemon && pokemon.length > 0) {
            for (var i = 0; i < pokemon.length; i++) {
                pokemon[i].bmi = calcBMI(pokemon[i].height, pokemon[i].weight);
            }
        }
    }

    (function init() {
        pokemon = data;
        for (var i = 0; i < pokemon.length; i++) {
            pokemon[i].id = parseInt(pokemon[i].id, 10);
            pokemon[i].height = parseInt(pokemon[i].height, 10);
            pokemon[i].weight = parseInt(pokemon[i].weight, 10);
            pokemon[i].color = colorMap[pokemon[i].type];
        }
        mapBMI();
    })();

    var x = d3.scale.linear()
            .domain([0, 155])
            .range([0, width]);

    var y = d3.scale.linear()
            .domain([0, 410])
            .range([height, 0]);

    var scale = d3.scale.sqrt()
            .domain([0, d3.max(pokemon, function (d) {
                return d.bmi;
            })])
            .range([0, 25]);

    var opacity = d3.scale.sqrt()
            .domain([d3.min(pokemon, function (d) {
                return d.bmi;
            }), d3.max(pokemon, function (d) {
                return d.bmi;
            })])
            .range([1, .5]);

//    var color = d3.scale.category10();
    var xAxis = d3.svg.axis().scale(x);
    var yAxis = d3.svg.axis().scale(y).orient("left");

    svg.append("g")
            .attr("class", "y axis")
            .call(yAxis)
            .append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", 20)
            .attr("y", -margin)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text(labelY);

    svg.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis)
            .append("text")
            .attr("x", width + 20)
            .attr("y", margin - 10)
            .attr("dy", ".71em")
            .style("text-anchor", "end")
            .text(labelX);

    svg.selectAll("circle")
            .data(pokemon)
            .enter()
            .insert("circle")
            .attr("cx", function (d) {
                return x(d.id);
            })
            .attr("cy", function (d) {
                return y(d.base_experience);
            })
            .attr("opacity", function (d) {
                return opacity(d.bmi);
            })
            .attr("r", function (d) {
                return scale(d.bmi);
            })
            .style("fill", function (d) {
                return d.color;
            })
            .on('mouseover', function (d) {
                fadeCircle(d.color, .1);
                fadeInText(d);
            })
            .on('mouseout', function (d) {
                fadeOutCircle();
                fadeOutText(d);
            })
            .transition()
            .duration(500)
            .ease("bounce");

    svg.selectAll("text")
            .data(pokemon)
            .enter()
            .append("text")
            .text(function (d) {
                return d.identifier + ' | bmi: ' + d3.round(d.bmi)  + ' | type: ' + d.type;
            })
            .attr("x", function (d) {
                return x(d.id);
            })
            .attr("y", function (d) {
                return y(d.base_experience);
            })
            .attr("font-family", "sans-serif")
            .attr("font-size", "20px")
            .attr("fill", "black")
            .attr("display", "none")
            .transition()
            .duration(500)
            .ease("bounce");

    function fadeCircle (c, opacity) {
        svg.selectAll("circle")
                .filter(function (d) {
                    return d.color != c;
                })
                .transition()
                .style("opacity", opacity);
    }

    function fadeOutCircle () {
        svg.selectAll("circle")
                .transition()
                .style("opacity", function (d) {
                    opacity(d.bmi);
                });
    }

    function fadeInText (pokemon) {
        svg.selectAll("text")
                .filter(function (d) {
                    return pokemon.identifier == d.identifier;
                })
                .transition()
                .style("display", "inline");
    }

    function fadeOutText (pokemon) {
        svg.selectAll("text")
                .filter(function (d) {
                    return pokemon.identifier == d.identifier;
                })
                .transition()
                .style("display", "none");
    }

});

</script>
</body>
</html>